<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>学生-云招聘学位核验平台</title>
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
	

<!-----css路径记得改改-------------------------------------------------------------------------------------------------------->
	<link rel="stylesheet" type="text/css" href="/static/stylesheets/head.css" />
	<link rel="stylesheet" type="text/css" href="/static/stylesheets/bottom.css" />
	<link rel="stylesheet" type="text/css" href="/static/layui/css/layui.css" >  
	<link rel="stylesheet" type="text/css" href="/static/stylesheets/student.css" />
	<link rel="stylesheet" type="text/css" href="/static/stylesheets/company.css">
<!----------------------------------------------------------------------------------------------------------------->
	
	
	
	<style>
		.stu_confirm_form_label{
			width: 30%;
			font-weight: 600;
			font-size: 18px;
		}
		.stu_confirm_fontsize{
			font-size: 18px;
		}
		.stu_confirm_prompt_content{
			font-size: 16px;
			color: #999;
			padding: 0 30px;
		}
		.stu_confirm_form_label3{
			font-size: 18px;
			width: 30%;
			font-weight: 600;
		}
	</style>
</head>
 
<body>
	<!-- 头 -->
	<%-include("../head.ejs")%>
		
		
<!------加入company.css----------------------------------------------->
	<section class="addNavBar">
		<div class="addNav_bgc">
			<div class="layui-container">
				<div class="addNav_text"><a href="/student/checkCertificate">证书确认</a></div>
				<div class="addNav_whiteLine">|</div>
				<div class="addNav_text"><a href="/student/">证书获取</a></div>
			</div>
		</div>
	</section>
<!----------------------------------------------------------------------------------------------------------------->
	
		
		
	<!-- 主体部分 -->
	<section class="student-search">
		<div class="layui-container" style="width: 70%;margin: auto;">
			<div>
				<div class="layui-row">
					
					<!-- 1、显示证书数据以及确认上传按钮 -->
<!---------------------显示证书数据页与学生获取证书页面相同----------------------------------------------------------------------->
					<section>
						<div name="filloutform" id="filloutform">
							<form action="" class="layui-form student_fillout_form" id="showCertificate">
								<!-- 显示证书数据 -->
								<div class="layui-form-item">
									<label class="student_fillout_label">确认证书内容</label>
								</div>
								<div class="layui-form-item">
									<label class="layui-form-label stu_confirm_form_label">证书编号:</label>
									<div class="layui-input-block">
										<div class="layui-form-mid layui-word-aux student_form_txhash_label stu_confirm_fontsize" id="serial_number" name="serial_number"></div>
									</div>
								</div>
								<div class="layui-form-item">
									<label class="layui-form-label stu_confirm_form_label">学校名称:</label>
									<div class="layui-input-block">
										<div class="layui-form-mid layui-word-aux student_form_txhash_label stu_confirm_fontsize" id="school_name" name="school_name"></div>
									</div>
								</div>
								<div class="layui-form-item">
									<label class="layui-form-label stu_confirm_form_label">姓名:</label>
									<div class="layui-input-block">
										<div class="layui-form-mid layui-word-aux student_form_txhash_label stu_confirm_fontsize" id="student_name" name="student_name"></div>
									</div>
								</div>
								<div class="layui-form-item">
									<label class="layui-form-label stu_confirm_form_label">学号:</label>
									<div class="layui-input-block">
										<div class="layui-form-mid layui-word-aux student_form_txhash_label stu_confirm_fontsize" id="student_number" name="student_number"></div>
									</div>
								</div>
								<div class="layui-form-item">
									<label class="layui-form-label stu_confirm_form_label">身份证号:</label>
									<div class="layui-input-block">
										<div class="layui-form-mid layui-word-aux student_form_txhash_label stu_confirm_fontsize"id="ID_number" name="ID_number">
										</div>
									</div>
								</div>
								<div class="layui-form-item">
									<label class="layui-form-label stu_confirm_form_label">专业名称:</label>
									<div class="layui-input-block">
										<div class="layui-form-mid layui-word-aux student_form_txhash_label stu_confirm_fontsize" id="profession" name="profession"></div>
									</div>
								</div>
								<div class="layui-form-item">
									<label class="layui-form-label stu_confirm_form_label">学位类别:</label>
									<div class="layui-input-block">
										<div class="layui-form-mid layui-word-aux student_form_txhash_label stu_confirm_fontsize" id="sort" name="sort"></div>
									</div>
								</div>

								<!-- 毕业日期 -->
								<div class="layui-form-item">
									<label class="layui-form-label stu_confirm_form_label">毕业日期:</label>
									<div class="layui-input-block">
										<div class="layui-form-mid layui-word-aux student_form_txhash_label stu_confirm_fontsize" id="graduation_date" name="graduation_date"></div>
									</div>
								</div>

								<!-- 确认上传 -->
								<div class="layui-form-item" style="text-align: center;">
									<button id="confirm_certificate" class="layui-btn" style="border-radius: 20px;background-color: #3887e5;font-size: 16px;width: 130px;font-weight: 500;" lay-submit lay-filter="formStep">确认上传</button>
								</div>
								
								<!-- 提示联系学校 -->
								<div class="layui-form-item" style="background-color: gainsboro; height: 1px; margin: 0 15%;"></div>
								<div class="layui-form-item">
									<div style="font-size: 17px; text-align: left; margin: 10px 0; padding-left: 15%;">
										说明：
									</div>
									<div class="stu_confirm_prompt_content" style="text-align: left; padding: 0 15%;">
										学位证书对学生十分重要,请学生仔细确认证书内容。如果证书内容存在错误，请及时联系学校相关负责人，并请不要点击确认上传按钮！
									</div>
								</div>
							</form>
						</div>
					</section>
<!----------------------------------------------------------------------------------------------------------------->
					
					
					
					<!-- 2、学生上传证书后的信息显示 -->
<!--------------------与学校端单次上传后，显示上传结果相同------------------------------------------------------------------------>
					<section>
						<div id="confilmSuccess" style="display: none;">
							<div style="text-align: center;margin-top: 10px;" id="laoding_icon">
								<i class=" layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"
								   style="color: rgb(150, 150, 150);font-size:30px;font-weight:bold; margin: 10px;"></i>
								   <div style="font-size: 20px;color: #333;font-weight: 500;margin-top: 10px;">
									上传中...
								</div>
							</div>

							<div style="text-align: center;margin-top: 10px;display: none;" id="success_icon">
								<i class="layui-icon layui-circle"
								   style="color: white;font-size:30px;font-weight:bold;background: #3887e5;padding: 10px;line-height: 60px;">&#xe605;</i>
								<div style="font-size: 20px;color: #333;font-weight: 500;margin-top: 10px;">
									证书上传成功
								</div>
							</div>

							<div class=" student_fillout_form">
								<form class="layui-form" style="margin: 0 auto;max-width: 600px;padding-top: 40px;" >
									<div class="layui-form-item">
										<label class="layui-form-label stu_confirm_form_label3">交易Hash值:</label>
										<div class="layui-input-block">
											<div class="layui-form-mid layui-word-aux com_res_form_text" style="font-size: 18px;" id="hash"></div>
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label stu_confirm_form_label3">汽油费:</label>
										<div class="layui-input-block">
											<div class="layui-form-mid layui-word-aux com_res_form_text" style="font-size: 18px;" id="gasoline"></div>
										</div>
									</div>

									<div class="layui-form-item">
										<label class="layui-form-label stu_confirm_form_label3">交易区块编号:</label>
										<div class="layui-input-block">
											<div class="layui-form-mid layui-word-aux com_res_form_text" style="font-size: 18px;" id="blockNumber"></div>
										</div>
									</div>

									<div class="layui-form-item">
										<label class="layui-form-label stu_confirm_form_label3">交易区块Hash值:</label>
										<div class="layui-input-block">
											<div class="layui-form-mid layui-word-aux com_res_form_text" style="font-size: 18px;" id="blockHash">111</div>
										</div>
									</div>

								  <!-- 获取证书跳转连接 -->
									<div style="text-align: center;margin-top: 10px;margin-bottom: 20px;">
										<a class="layui-btn next" style="border-radius: 20px;background-color: #3887e5;font-size: 16px;width: 130px;font-weight: 500;" href="">获取证书</a>
									</div>
								</form>
							</div>

						</div>
					</section>
<!----------------------------------------------------------------------------------------------------------------->
					
					
					
					
					<!-- 3、显示已完成上传界面 -->
					<section>
						<div class=" student_fillout_form" id="successfully_uploaded_certificate" style="height: 356px; display: none;">
							<div style="text-align: center;margin: 10% auto;" id="smile_icon">
								<i class=" layui-icon layui-icon-face-smile"
								   style="color: rgb(150, 150, 150);font-size:50px;font-weight:bold; margin: 20px;"></i>
								<div style="text-align: center;font-size: 20px;color: #333;font-weight: 500;margin-top: 10px;margin-bottom: 15px;">
									您已完成证书上传！
								</div>
								<!-- 获取证书跳转连接 -->
								<div style="text-align: center;margin-top: 10px;margin-bottom: 20px;">
									<a class="layui-btn next" style="border-radius: 20px;background-color: #3887e5;font-size: 16px;width: 130px;font-weight: 500;" href="">获取证书</a>
								</div>
							</div>
						</div>
					</section>
					
				</div>
			</div>
		</div>
	</section>



		<!-- 页面脚 -->
	<%-include("../foot.ejs")%>


<!------别忘了改script的路径哦！以及还加了一个jquery.js------------------------------------------------------------------------------------------->
	<script type="text/javascript" src="/static/layuimini/lib/jquery-3.4.1/jquery-3.4.1.min.js"></script>
		<script src="/static/layui/layui.js"></script>
<!----------------------------------------------------------------------------------------------------------------->

	<script>
		
		layui.use(['form','laydate','element'], function(){
		  var $ = layui.jquery,
			  form = layui.form,
			  $ = layui.$,
			  laydate = layui.laydate,
			  step = layui.step,
			  element = layui.element//导航的hover效果、二级菜单等功能，需要依赖element模块
			  ;
			
			
//---------新增js-----------------------------------------------------------------------------------------
			var certificate='';
			//每次进入界面时需要判断是否确认上传证书
			$("#successfully_uploaded_certificate").ready(function(){
				console.log("hhh")
				$.ajax({
					url:'/student/api/uncheckedCertificate',
					method:'GET',
					success:(res)=>{
						//如果没有确认上传，显示确认上传界面
						if(res.code==0){
							console.log(res)
							certificate=res.data[0];
							updateCertificate();
							$("#successfully_uploaded_certificate").hide();
							$("#filloutform").show();
						}
						//如果已成功上传，显示无需上传界面
						else{
							$("#successfully_uploaded_certificate").show();
							$("#filloutform").hide();
						}
					}
				})
			});
			
			
			//显示证书信息
			function updateCertificate(){
				// 将每个div中的值赋值
				$('#serial_number').html(certificate.certificatenumber);//证书编号
				$('#school_name').html(certificate.school);
				$('#student_name').html(certificate.name);
				$('#student_number').html(certificate.studentnumber);
				$('#ID_number').html(certificate.idnumber);
				$('#profession').html(certificate.major);
				$('#sort').html(certificate.degreetype);//毕业年月
				$('#graduation_date').html(certificate.graduationdate);//学位
			};			
			
			//监听提交
		  form.on('submit(formStep)', function(data){
			// layer.msg(JSON.stringify(data.field));
			  
			  //点击确认上传按钮，出现弹出框
			layer.confirm("确认上传证书吗？",{
					icon:3, 
					title: "提示",
					btn: ["确认","取消"],
				}, 
				function(index, layero){
					//关闭询问框
					layer.close(index);
					//显示上传信息界面
					$("#confilmSuccess").show();
					$("#filloutform").hide();
					//获取上链成功后返回的信息
					$.post('/student/api/checkCertificate',{check_id:certificate._id},(res)=>{
						console.log(res);
						if(res.code==0){
							$("#laoding_icon").hide();
							$("#success_icon").show();
							$('#hash').html(res.data.hash);//交易hash值
							$('#gasoline').html(res.data.gas);//汽油费
							$('#blockNumber').html(res.data.blockNumber); // 交易区块编号
							$('#blockHash').html(res.data.blockHash);// 交易区块Hash值

						}
						else{
							layer.alert("上链失败！")
						}
					})
					return false;
				},function(index){
					//关闭询问框
					layer.close(index);
					$("#confilmSuccess").hide();
					$("#filloutform").show();
					layer.alert("上传失败！"+res.msg);
				})
			return false;
		  });
//-------------------------------------------------------------------------------------------------------------
			
			  //修改密码
			  $("#changePasswordBtn").click(function(){
				  $.get('/changePassword',(res)=>{
					  var index = layer.open({
                    title: '修改密码',
                    type: 1,
                    shade: 0.2,
                    maxmin:true,
                    shadeClose: true,
					area:['500px','400px'],
                    content:res
						
                });
				$(window).on("resize", function () {
                    layer.full(index);
                });
				  })
				
			})
		  
		  //用户退出
		  	$(".login-out").click(function(){
		  		layer.confirm("确认退出系统吗？",{
					icon:3, title: "提示",
					}, 
					function(index){
						//关闭询问框
						layer.close(index);
						//跳转
						window.location.href = "/logout";
		  		})
		  	});
			
			
		});
		
	</script>
</body>
</html>
